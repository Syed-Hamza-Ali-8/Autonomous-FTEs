{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ai-employee.vault/schemas/audit-log-entry.json",
  "title": "Enhanced Audit Log Entry",
  "description": "Schema for comprehensive audit logging in Gold Tier with cross-domain tracking",
  "version": "2.0",
  "type": "object",
  "required": [
    "timestamp",
    "action_id",
    "action_type",
    "domain",
    "actor",
    "status",
    "duration_ms"
  ],
  "properties": {
    "timestamp": {
      "type": "string",
      "description": "ISO-8601 timestamp when action occurred",
      "format": "date-time",
      "examples": ["2026-01-15T10:00:00.123Z"]
    },
    "action_id": {
      "type": "string",
      "description": "Unique action identifier",
      "pattern": "^act_[a-z0-9_]+$",
      "examples": ["act_20260115_103000_001"]
    },
    "action_type": {
      "type": "string",
      "description": "Type of action performed",
      "enum": [
        "email_sent",
        "email_received",
        "whatsapp_sent",
        "whatsapp_received",
        "linkedin_post",
        "facebook_post",
        "instagram_post",
        "twitter_post",
        "xero_sync",
        "xero_invoice_created",
        "xero_invoice_updated",
        "xero_payment_recorded",
        "file_created",
        "file_modified",
        "file_moved",
        "file_deleted",
        "task_created",
        "task_completed",
        "approval_requested",
        "approval_granted",
        "approval_denied",
        "ceo_briefing_generated",
        "cross_domain_analysis",
        "error_recovery",
        "system_health_check",
        "mcp_call",
        "ralph_wiggum_iteration",
        "other"
      ]
    },
    "domain": {
      "type": "string",
      "description": "Domain where action occurred",
      "enum": ["personal", "business", "system", "cross_domain"]
    },
    "actor": {
      "type": "object",
      "description": "Entity that performed the action",
      "required": ["type", "id"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of actor",
          "enum": ["system", "user", "watcher", "agent", "mcp_server", "scheduler"]
        },
        "id": {
          "type": "string",
          "description": "Actor identifier",
          "examples": ["gmail_watcher", "xero_mcp", "hamza", "ceo_briefing_scheduler"]
        },
        "name": {
          "type": "string",
          "description": "Human-readable actor name",
          "examples": ["Gmail Watcher", "Xero MCP Server", "Hamza"]
        }
      }
    },
    "status": {
      "type": "string",
      "description": "Action execution status",
      "enum": ["success", "partial_success", "failed", "pending", "cancelled"]
    },
    "duration_ms": {
      "type": "number",
      "description": "Action duration in milliseconds",
      "minimum": 0,
      "examples": [1234.56]
    },
    "target": {
      "type": "object",
      "description": "Target of the action",
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of target",
          "examples": ["file", "email", "post", "invoice", "transaction"]
        },
        "id": {
          "type": "string",
          "description": "Target identifier",
          "examples": ["msg_gmail_abc123", "post_linkedin_20260115", "xero_tx_12345"]
        },
        "path": {
          "type": "string",
          "description": "File path if target is a file",
          "examples": ["/Vault/Needs_Action/msg_gmail_abc123.md"]
        }
      }
    },
    "context": {
      "type": "object",
      "description": "Additional context for the action",
      "properties": {
        "context_id": {
          "type": "string",
          "description": "Cross-domain context ID if applicable",
          "pattern": "^ctx_[a-z0-9_]+$"
        },
        "task_id": {
          "type": "string",
          "description": "Ralph Wiggum task ID if applicable",
          "pattern": "^task_[a-z0-9_]+$"
        },
        "parent_action_id": {
          "type": "string",
          "description": "Parent action ID if this is a sub-action",
          "pattern": "^act_[a-z0-9_]+$"
        },
        "trigger_event": {
          "type": "string",
          "description": "Event that triggered this action",
          "maxLength": 200
        },
        "user_initiated": {
          "type": "boolean",
          "description": "Whether action was initiated by user"
        }
      }
    },
    "input": {
      "type": "object",
      "description": "Input data for the action",
      "properties": {
        "parameters": {
          "type": "object",
          "description": "Action parameters"
        },
        "size_bytes": {
          "type": "integer",
          "description": "Size of input data in bytes",
          "minimum": 0
        }
      }
    },
    "output": {
      "type": "object",
      "description": "Output data from the action",
      "properties": {
        "result": {
          "type": "object",
          "description": "Action result data"
        },
        "size_bytes": {
          "type": "integer",
          "description": "Size of output data in bytes",
          "minimum": 0
        },
        "files_created": {
          "type": "array",
          "description": "Files created by this action",
          "items": {
            "type": "string"
          }
        },
        "files_modified": {
          "type": "array",
          "description": "Files modified by this action",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "error": {
      "type": "object",
      "description": "Error details if action failed",
      "properties": {
        "type": {
          "type": "string",
          "description": "Error type",
          "enum": ["transient", "auth", "logic", "data", "system"]
        },
        "message": {
          "type": "string",
          "description": "Error message",
          "maxLength": 1000
        },
        "code": {
          "type": "string",
          "description": "Error code",
          "examples": ["ECONNREFUSED", "EAUTH", "EVALIDATION"]
        },
        "stack": {
          "type": "string",
          "description": "Error stack trace (truncated)",
          "maxLength": 2000
        },
        "recoverable": {
          "type": "boolean",
          "description": "Whether error is recoverable"
        },
        "retry_count": {
          "type": "integer",
          "description": "Number of retry attempts",
          "minimum": 0
        }
      }
    },
    "approval": {
      "type": "object",
      "description": "Approval details if action required approval",
      "properties": {
        "required": {
          "type": "boolean",
          "description": "Whether approval was required"
        },
        "status": {
          "type": "string",
          "description": "Approval status",
          "enum": ["pending", "approved", "denied", "not_required"]
        },
        "approved_by": {
          "type": "string",
          "description": "User who approved",
          "examples": ["hamza"]
        },
        "approved_at": {
          "type": "string",
          "description": "ISO-8601 timestamp when approved",
          "format": "date-time"
        },
        "approval_duration_ms": {
          "type": "number",
          "description": "Time taken for approval in milliseconds",
          "minimum": 0
        }
      }
    },
    "metrics": {
      "type": "object",
      "description": "Performance and resource metrics",
      "properties": {
        "api_calls": {
          "type": "integer",
          "description": "Number of API calls made",
          "minimum": 0
        },
        "tokens_used": {
          "type": "integer",
          "description": "LLM tokens used",
          "minimum": 0
        },
        "cost_usd": {
          "type": "number",
          "description": "Estimated cost in USD",
          "minimum": 0
        },
        "memory_mb": {
          "type": "number",
          "description": "Peak memory usage in MB",
          "minimum": 0
        },
        "cpu_percent": {
          "type": "number",
          "description": "Average CPU usage percentage",
          "minimum": 0,
          "maximum": 100
        }
      }
    },
    "security": {
      "type": "object",
      "description": "Security-related information",
      "properties": {
        "sensitive_data": {
          "type": "boolean",
          "description": "Whether action involved sensitive data"
        },
        "data_classification": {
          "type": "string",
          "description": "Data classification level",
          "enum": ["public", "internal", "confidential", "restricted"]
        },
        "encryption_used": {
          "type": "boolean",
          "description": "Whether encryption was used"
        },
        "audit_required": {
          "type": "boolean",
          "description": "Whether this action requires audit review"
        }
      }
    },
    "tags": {
      "type": "array",
      "description": "Tags for categorization and search",
      "items": {
        "type": "string"
      },
      "examples": [["email", "client", "urgent"]]
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "additionalProperties": true
    }
  },
  "examples": [
    {
      "timestamp": "2026-01-15T10:00:00.123Z",
      "action_id": "act_20260115_103000_001",
      "action_type": "cross_domain_analysis",
      "domain": "cross_domain",
      "actor": {
        "type": "agent",
        "id": "cross_domain_reasoner",
        "name": "Cross-Domain Reasoner"
      },
      "status": "success",
      "duration_ms": 1234.56,
      "target": {
        "type": "context",
        "id": "ctx_personal_20260115_103000"
      },
      "context": {
        "context_id": "ctx_personal_20260115_103000",
        "trigger_event": "Payment received from Client A ($1,500)",
        "user_initiated": false
      },
      "input": {
        "parameters": {
          "event_type": "payment_received",
          "amount": 1500.00,
          "currency": "USD"
        },
        "size_bytes": 512
      },
      "output": {
        "result": {
          "personal_actions": 1,
          "business_actions": 2,
          "total_actions": 3
        },
        "size_bytes": 2048,
        "files_created": [
          "/Vault/Context/ctx_personal_20260115_103000.md"
        ]
      },
      "metrics": {
        "api_calls": 3,
        "tokens_used": 1500,
        "cost_usd": 0.015,
        "memory_mb": 45.2,
        "cpu_percent": 12.5
      },
      "security": {
        "sensitive_data": true,
        "data_classification": "confidential",
        "encryption_used": true,
        "audit_required": true
      },
      "tags": ["cross_domain", "payment", "client_a", "automated"],
      "metadata": {
        "version": "1.0",
        "environment": "production"
      }
    }
  ],
  "additionalProperties": false
}
